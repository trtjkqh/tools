<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åœ¨çº¿Excelè½¬JSONå·¥å…·</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="åœ¨çº¿Excelè½¬JSONå·¥å…·ï¼Œå¿«é€Ÿå°†Excelæˆ–CSVæ–‡ä»¶è½¬æ¢ä¸ºJSONæ ¼å¼ï¼Œæ”¯æŒæ•°æ®é¢„è§ˆã€åˆ—é€‰æ‹©ã€æ ¼å¼åŒ–å’Œä¸‹è½½åŠŸèƒ½ã€‚">

    <!-- xlsx.jsåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        body {margin:0; font-family:"Microsoft YaHei",sans-serif; background:#f5f5f5; color:#333;}
        .container {max-width:1200px; margin:0 auto; padding:20px; display:flex; flex-direction:column; min-height:100vh;}
        header{text-align:center; margin-bottom:30px;}
        header h1{font-size:2rem; margin-bottom:10px;}
        header p.subtitle{font-size:1rem; color:#666;}
        .tool-container{display:flex; flex-wrap:wrap; gap:20px; margin-bottom:30px;}
        .input-section, .output-section{flex:1 1 500px;}
        .card{background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08);}
        .card-title{font-size:1.2rem; margin-bottom:15px;}
        .file-upload-area{border:2px dashed #ccc; padding:40px; text-align:center; border-radius:10px; cursor:pointer; transition:border-color .3s;}
        .file-upload-area:hover{border-color:#007bff;}
        .file-upload-icon{font-size:2.5rem; margin-bottom:10px;}
        #fileInfo{margin-top:10px; font-size:0.9rem;}
        .columns-container{margin-top:20px;}
        .columns-grid{display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;}
        .action-buttons, .output-actions{margin-top:20px; display:flex; gap:10px; flex-wrap:wrap;}
        button{padding:8px 15px; border:none; border-radius:6px; cursor:pointer; transition: background-color .2s; font-size:0.9rem;}
        .btn-primary{background:#007bff; color:#fff;}
        .btn-primary:hover{background:#0069d9;}
        .btn-warning{background:#ffc107; color:#333;}
        .btn-warning:hover{background:#e0a800;}
        .btn-secondary{background:#28a745; color:#fff;}
        .btn-secondary:hover{background:#218838;}
        .btn-utility{background:#6c757d; color:#fff;}
        .btn-utility:hover{background:#5a6268;}
        #jsonOutput{width:100%; min-height:250px; resize:vertical; padding:10px; border-radius:8px; border:1px solid #ccc; font-family:Consolas,monospace; font-size:0.9rem; margin-top:10px; background:#f8f8f8;}
        .instructions{margin-bottom:30px;}
        .instructions h2{font-size:1.5rem; margin-bottom:15px;}
        .instruction-card{background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.05); margin-bottom:15px;}
        .instruction-card h3{font-size:1.1rem; margin-bottom:10px;}
        .instruction-card ul{padding-left:20px;}
        footer{text-align:center; font-size:0.8rem; color:#888; margin-top:auto; padding:15px 0;}
        @media(max-width:900px){.tool-container{flex-direction:column;}}
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>åœ¨çº¿Excelè½¬JSONå·¥å…·</h1>
        <p class="subtitle">å¿«é€Ÿå°†Excelæˆ–CSVæ–‡ä»¶è½¬æ¢ä¸ºJSONæ ¼å¼ï¼Œæ”¯æŒæ•°æ®é¢„è§ˆã€åˆ—é€‰æ‹©ã€æ ¼å¼åŒ–å’Œä¸‹è½½åŠŸèƒ½</p>
    </header>

    <div class="tool-container">
        <div class="input-section">
            <div class="card">
                <h2 class="card-title">ğŸ“¤ è¾“å…¥æ–‡ä»¶</h2>
                <div id="fileUploadArea" class="file-upload-area">
                    <div class="file-upload-icon">ğŸ“</div>
                    <h3>æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </h3>
                    <p>æ”¯æŒ .xlsx å’Œ .csv æ–‡ä»¶æ ¼å¼</p>
                    <p><small>(CSVæ–‡ä»¶éœ€ä¸ºUTF-8ç¼–ç )</small></p>
                    <input type="file" id="fileInput" accept=".xlsx,.csv" style="display:none;">
                </div>
                <div id="fileInfo" class="file-info"><strong>å·²é€‰æ‹©æ–‡ä»¶:</strong> <span id="fileName"></span> <span id="fileSize"></span></div>
                <div id="columnsContainer" class="columns-container" style="display:none;">
                    <h3>é€‰æ‹©è¦è½¬æ¢çš„åˆ— (é»˜è®¤å…¨é€‰):</h3>
                    <div id="columnsGrid" class="columns-grid"></div>
                </div>
                <div id="uploadStatus" class="status-message"></div>
                <div class="action-buttons">
                    <button id="convertBtn" class="btn btn-primary" disabled>è½¬æ¢ä¸ºJSON</button>
                    <button id="clearBtn" class="btn btn-warning">æ¸…ç©ºæ‰€æœ‰</button>
                </div>
            </div>
        </div>

        <div class="output-section">
            <div class="card">
                <h2 class="card-title">ğŸ“¥ è¾“å‡ºç»“æœ</h2>
                <textarea id="jsonOutput" placeholder="è½¬æ¢åçš„JSONæ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
                <div class="output-actions">
                    <button id="formatBtn" class="btn btn-utility" disabled>âœ¨ æ ¼å¼åŒ–</button>
                    <button id="compressBtn" class="btn btn-utility" disabled>ğŸ” å‹ç¼©</button>
                    <button id="downloadBtn" class="btn btn-secondary" disabled>ğŸ’¾ ä¸‹è½½JSON</button>
                </div>
            </div>
        </div>
    </div>

    <div class="instructions">
        <h2>ğŸ“ ä½¿ç”¨è¯´æ˜</h2>
        <div class="instructions-content">
            <div class="instruction-card">
                <h3>â„¹ï¸ å·¥å…·ç®€ä»‹</h3>
                <p>åœ¨çº¿Excelè½¬JSONå·¥å…·ï¼Œæ‰“å¼€Excelæˆ–è€…CSVæ–‡ä»¶ï¼Œè½¬æ¢ä¸ºJSONæ ¼å¼çš„æ•°æ®ï¼Œè½¬æ¢åçš„JSONæ•°æ®æ”¯æŒå¤åˆ¶å’Œä¸‹è½½ã€‚</p>
            </div>
            <div class="instruction-card">
                <h3>ğŸ“‹ æ–‡ä»¶è¦æ±‚</h3>
                <ul>
                    <li>æ”¯æŒ.xlsxå’Œ.csvæ–‡ä»¶æ ¼å¼</li>
                    <li>CSVæ–‡ä»¶éœ€ä½¿ç”¨UTF-8ç¼–ç </li>
                    <li>ç¬¬ä¸€è¡Œä¸ºåˆ—å(ä¸æ”¯æŒå¤šè¡Œç»„åˆåˆ—å)</li>
                    <li>ç¬¬äºŒè¡Œå¼€å§‹ä¸ºæ•°æ®å†…å®¹</li>
                </ul>
            </div>
            <div class="instruction-card">
                <h3>âš™ï¸ åŠŸèƒ½è¯´æ˜</h3>
                <ul>
                    <li>æ‰“å¼€ï¼šä¸Šä¼ Excelæˆ–CSVæ–‡ä»¶</li>
                    <li>è½¬æ¢ï¼šå°†è¡¨æ ¼æ•°æ®è½¬æ¢ä¸ºJSONæ ¼å¼</li>
                    <li>åˆ—é€‰æ‹©ï¼šé€‰æ‹©è¦åŒ…å«åœ¨JSONä¸­çš„åˆ—</li>
                    <li>æ ¼å¼åŒ–ï¼šç¾åŒ–JSONè¾“å‡ºæ ¼å¼</li>
                    <li>å‹ç¼©ï¼šå‹ç¼©JSONä¸ºå•è¡Œæ ¼å¼</li>
                    <li>ä¸‹è½½ï¼šå°†JSONä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶</li>
                    <li>æ¸…ç©ºï¼šé‡ç½®æ‰€æœ‰æ•°æ®</li>
                </ul>
            </div>
        </div>
    </div>

    <footer>Â© 2023 åœ¨çº¿Excelè½¬JSONå·¥å…· | æ•°æ®åœ¨æµè§ˆå™¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</footer>
</div>

<script>
const fileInput = document.getElementById('fileInput');
const fileUploadArea = document.getElementById('fileUploadArea');
const fileNameEl = document.getElementById('fileName');
const fileSizeEl = document.getElementById('fileSize');
const columnsContainer = document.getElementById('columnsContainer');
const columnsGrid = document.getElementById('columnsGrid');
const convertBtn = document.getElementById('convertBtn');
const clearBtn = document.getElementById('clearBtn');
const formatBtn = document.getElementById('formatBtn');
const compressBtn = document.getElementById('compressBtn');
const downloadBtn = document.getElementById('downloadBtn');
const jsonOutput = document.getElementById('jsonOutput');

let workbookData = [];
let headers = [];

// ç‚¹å‡»ä¸Šä¼ 
fileUploadArea.addEventListener('click', () => fileInput.click());

// æ‹–æ‹½ä¸Šä¼ 
fileUploadArea.addEventListener('dragover', e => { e.preventDefault(); fileUploadArea.style.borderColor='#007bff'; });
fileUploadArea.addEventListener('dragleave', e => { e.preventDefault(); fileUploadArea.style.borderColor='#ccc'; });
fileUploadArea.addEventListener('drop', e => {
    e.preventDefault();
    fileUploadArea.style.borderColor='#ccc';
    if(e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
});

// æ–‡ä»¶é€‰æ‹©
fileInput.addEventListener('change', e => handleFile(e.target.files[0]));

function handleFile(file){
    if(!file) return;
    const name = file.name;
    fileNameEl.textContent = name;
    fileSizeEl.textContent = ` (${(file.size/1024).toFixed(2)} KB)`;

    const reader = new FileReader();
    reader.onload = e => {
        let data = e.target.result;
        try {
            let wb;
            if(name.endsWith('.csv')){
                wb = XLSX.read(data, {type:'binary', codepage:65001});
            } else {
                wb = XLSX.read(data, {type:'binary'});
            }
            const ws = wb.Sheets[wb.SheetNames[0]];
            workbookData = XLSX.utils.sheet_to_json(ws, {defval:''});
            headers = Object.keys(workbookData[0] || {});
            renderColumns();
        } catch(err){
            alert('æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ã€‚');
            console.error(err);
        }
    };
    if(file.name.endsWith('.csv')) reader.readAsBinaryString(file);
    else reader.readAsBinaryString(file);

    convertBtn.disabled = false;
}

// æ¸²æŸ“åˆ—é€‰æ‹©
function renderColumns(){
    columnsGrid.innerHTML = '';
    headers.forEach(h => {
        const label = document.createElement('label');
        label.style.marginRight='10px';
        label.innerHTML = `<input type="checkbox" value="${h}" checked> ${h}`;
        columnsGrid.appendChild(label);
    });
    columnsContainer.style.display = headers.length ? 'block':'none';
}

// è½¬æ¢
convertBtn.addEventListener('click', () => {
    const checked = Array.from(columnsGrid.querySelectorAll('input[type=checkbox]:checked')).map(i=>i.value);
    const result = workbookData.map(row=>{
        const obj={};
        checked.forEach(col=> obj[col]=row[col]);
        return obj;
    });
    jsonOutput.value = JSON.stringify(result,null,4);
    formatBtn.disabled=false;
    compressBtn.disabled=false;
    downloadBtn.disabled=false;
});

// æ ¼å¼åŒ–
formatBtn.addEventListener('click', ()=>{
    try { jsonOutput.value = JSON.stringify(JSON.parse(jsonOutput.value), null, 4); } 
    catch(err){ alert('JSONæ ¼å¼é”™è¯¯'); }
});

// å‹ç¼©
compressBtn.addEventListener('click', ()=>{
    try { jsonOutput.value = JSON.stringify(JSON.parse(jsonOutput.value)); } 
    catch(err){ alert('JSONæ ¼å¼é”™è¯¯'); }
});

// ä¸‹è½½
downloadBtn.addEventListener('click', ()=>{
    const blob = new Blob([jsonOutput.value], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href=url;
    a.download='data.json';
    a.click();
    URL.revokeObjectURL(url);
});

// æ¸…ç©º
clearBtn.addEventListener('click', ()=>{
    fileInput.value='';
    fileNameEl.textContent='';
    fileSizeEl.textContent='';
    workbookData=[];
    headers=[];
    columnsGrid.innerHTML='';
    columnsContainer.style.display='none';
    jsonOutput.value='';
    convertBtn.disabled=true;
    formatBtn.disabled=true;
    compressBtn.disabled=true;
    downloadBtn.disabled=true;
});
</script>
</body>
</html>
